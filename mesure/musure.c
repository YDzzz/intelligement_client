//
// Created by YDzzz on 2024/6/29.
//

#include "../tools/Tools.h"
#include <stdlib.h>
#define WEN 0
#define DU 1
#define GUANG 2
#define QIANG 3
#define QI 4
#define YA 5
#define SHI 6

char words_buf[][24/8*21] = {
        /*--  文字:  温  --*/
/*--  宋体16;  此字体下对应的点阵为：宽x高=21x21   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=24x21  --*/
        {0x00,0x00,0x00,0x00,0x00,0x00,0x39,0xFF,0xC0,0x1D,0xC1,0xC0,0x0F,0xC1,0x80,0x07,
        0xFF,0x80,0xE7,0xC1,0x80,0x77,0xC1,0x80,0x37,0xC1,0x80,0x3D,0xFF,0x80,0x0D,0xC1,
        0x80,0x0C,0x00,0x00,0x1F,0xFF,0xE0,0x1B,0x76,0xE0,0x7B,0x76,0xE0,0x3B,0x76,0xE0,
        0x3B,0x76,0xE0,0x3B,0x76,0xE0,0x3F,0xFF,0xF8,0x10,0x00,0x00,0x00,0x00,0x00},

/*--  文字:  度  --*/
/*--  宋体16;  此字体下对应的点阵为：宽x高=21x21   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=24x21  --*/
        {0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x38,0x60,0x1F,0xFF,0xF0,0x18,0x00,0x00,0x18,
        0xE7,0x00,0x18,0xC7,0x60,0x1F,0xFF,0xF0,0x18,0xC7,0x00,0x18,0xC7,0x00,0x38,0xFF,
        0x00,0x38,0xC7,0x00,0x3B,0xFF,0x80,0x38,0xC3,0x80,0x30,0x67,0x00,0x30,0x7E,0x00,
        0x70,0x3C,0x00,0x60,0x7F,0x00,0x63,0xE7,0xF8,0xDF,0x00,0xE0,0x00,0x00,0x00},

        /*--  文字:  光  --*/
/*--  宋体16;  此字体下对应的点阵为：宽x高=21x21   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=24x21  --*/
        {0x00,0x00,0x00,0x00,0x70,0x00,0x00,0x70,0x00,0x0C,0x71,0x00,0x0E,0x73,0x80,0x07,
        0x73,0x80,0x07,0xF7,0x00,0x03,0xF6,0x00,0x03,0x7E,0x60,0x7F,0xFF,0xF0,0x21,0x9C,
        0x00,0x01,0x9C,0x00,0x03,0x9C,0x00,0x03,0x9C,0x30,0x03,0x9C,0x30,0x03,0x1C,0x30,
        0x07,0x1C,0x70,0x0E,0x1C,0x78,0x3C,0x0F,0xF0,0xF0,0x00,0x00,0x00,0x00,0x00},

/*--  文字:  强  --*/
/*--  宋体16;  此字体下对应的点阵为：宽x高=21x21   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=24x21  --*/
        {0x00,0x00,0x00,0x03,0x7F,0xE0,0x7F,0xF0,0xE0,0x03,0x70,0xC0,0x03,0x70,0xC0,0x03,
        0x7F,0xC0,0x3F,0x76,0xE0,0x33,0x06,0x00,0x30,0x06,0x00,0x30,0xFF,0xF0,0x70,0x66,
        0x60,0x7F,0xE6,0x60,0x37,0x66,0x60,0x07,0xFF,0xE0,0x07,0xE6,0x60,0x07,0x06,0xC0,
        0x07,0x06,0x60,0x06,0x07,0xF0,0x3F,0xFF,0xF8,0x1D,0xE0,0x30,0x00,0x00,0x00},

        /*--  文字:  气  --*/
/*--  宋体16;  此字体下对应的点阵为：宽x高=21x21   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=24x21  --*/
        {0x00,0x00,0x00,0x07,0x00,0x00,0x07,0x00,0x00,0x0E,0x00,0xC0,0x0F,0xFF,0xE0,0x1C,
        0x01,0x00,0x1F,0xFF,0x80,0x38,0x00,0x00,0x30,0x02,0x00,0x7F,0xFF,0x00,0xC0,0x07,
        0x00,0x00,0x07,0x00,0x00,0x07,0x00,0x00,0x07,0x00,0x00,0x07,0x00,0x00,0x03,0x30,
        0x00,0x03,0xB0,0x00,0x03,0xF0,0x00,0x01,0xF0,0x00,0x00,0xF0,0x00,0x00,0x00},

/*--  文字:  压  --*/
/*--  宋体16;  此字体下对应的点阵为：宽x高=21x21   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=24x21  --*/
        {0x00,0x00,0x00,0x00,0x00,0xE0,0x1F,0xFF,0xF0,0x1C,0x00,0x00,0x1C,0x38,0x00,0x1C,
        0x38,0x00,0x1C,0x38,0x00,0x1C,0x38,0x00,0x1C,0x38,0xC0,0x1F,0xFF,0xE0,0x1D,0x38,
        0x00,0x1C,0x3E,0x00,0x1C,0x3F,0x00,0x18,0x3B,0x80,0x18,0x3B,0xC0,0x38,0x39,0xC0,
        0x30,0x39,0xC0,0x30,0x38,0x60,0x7F,0xFF,0xF0,0xC0,0x00,0x00,0x00,0x00,0x00},

        /*--  文字:  湿  --*/
/*--  宋体16;  此字体下对应的点阵为：宽x高=21x21   --*/
/*--  宽度不是8的倍数，现调整为：宽度x高度=24x21  --*/
        {0x00,0x00,0x00,0x38,0x00,0xC0,0x1D,0xFF,0xE0,0x1D,0xC0,0xC0,0x0B,0xC0,0xC0,0x03,
        0xFF,0xC0,0xE7,0xC0,0xC0,0x77,0xC0,0xC0,0x3F,0xFF,0xE0,0x3D,0xF6,0xC0,0x0C,0x3F,
        0x00,0x1F,0x37,0x70,0x1B,0xB7,0x70,0xF9,0xB7,0xE0,0x39,0xF7,0xC0,0x39,0xF7,0x80,
        0x38,0xB7,0x00,0x78,0x37,0x30,0x3F,0xFF,0xF0,0x04,0x00,0x00,0x00,0x00,0x00}



};

int led_all_fd;
int beep_fd;
int led_1_fd;
int led_2_fd;
int led_3_fd;
int led_4_fd;

void led_1_start(){
    led_ctrl(led_1_fd,1);
}

void led_1_end(){
    led_ctrl(led_1_fd,0);
}

void led_2_start(){
    led_ctrl(led_2_fd,1);
}

void led_2_end(){
    led_ctrl(led_2_fd,0);
}

void led_3_start(){
    led_ctrl(led_3_fd,1);
}

void led_3_end(){
    led_ctrl(led_3_fd,0);
}

void led_4_start(){
    led_ctrl(led_4_fd,1);
}

void led_4_end(){
    led_ctrl(led_4_fd,0);
}

void start(){
    led_ctrl(led_all_fd,1);
    beep_ctrl(beep_fd,1);
}

void stop(){
    led_ctrl(led_all_fd,0);
    beep_ctrl(beep_fd,0);
}

void* routine1(void*arg)
{
    detect_env();
}

int pthread_flag = 0;
void* routine(void*arg)
{
    while(1)
    {
        if(pthread_flag)
            pthread_exit(NULL);
        get_touch();
    }
}
int ret;
int ret1;
void myexit(){
    touch_close();
    lcd_init();
    detect_pthread_exit();
    system("./main");
    exit(0);
}

int main(){
    lcd_init();
    touch_init();
    printf("init success");


    led_all_fd = open("/sys/kernel/gec_ctrl/led_all", O_RDWR);
    beep_fd = open("/sys/kernel/gec_ctrl/beep", O_RDWR);
    led_1_fd = open("/sys/kernel/gec_ctrl/led_d7", O_RDWR);
    led_2_fd = open("/sys/kernel/gec_ctrl/led_d8", O_RDWR);
    led_3_fd = open("/sys/kernel/gec_ctrl/led_d9", O_RDWR);
    led_4_fd = open("/sys/kernel/gec_ctrl/led_d10", O_RDWR);

    button(0,0,"./res/light.bmp", &start);
    button(100,0,"./res/close.bmp", &stop);
    button(0,100,"./res/light.bmp", &led_1_start);
    button(100,100,"./res/close.bmp", &led_1_end);
    button(0,200,"./res/light.bmp", &led_2_start);
    button(100,200,"./res/close.bmp", &led_2_end);
    button(0,300,"./res/light.bmp", &led_3_start);
    button(100,300,"./res/close.bmp", &led_3_end);
    button(0,400,"./res/light.bmp", &led_4_start);
    button(100,400,"./res/close.bmp", &led_4_end);
    button(736,0, "./res/exit.bmp", &myexit);
    printf("button init success");

    word(300,90,24,21,0x00ffffff, words_buf[GUANG]);
    word(350,90,24,21,0x00ffffff, words_buf[QIANG]);
    word(300,190,24,21,0x00ffffff, words_buf[WEN]);
    word(350,190,24,21,0x00ffffff, words_buf[DU]);
    word(300,290,24,21,0x00ffffff, words_buf[SHI]);
    word(350,290,24,21,0x00ffffff, words_buf[DU]);
    word(300,390,24,21,0x00ffffff, words_buf[QI]);
    word(350,390,24,21,0x00ffffff, words_buf[YA]);

    pthread_t id1;
    ret1 = pthread_create(&id1,NULL,routine1,NULL);

    while (1){
        get_touch();
    }
}



